#!/bin/bash

set -eux

INFLUXDB_URL="http://127.0.0.1:8086"

# Setup the admin user
curl -G "${INFLUXDB_URL}/query" \
    --data-urlencode "q=CREATE USER root WITH PASSWORD '<%= @influxdb_rootpass %>' WITH ALL PRIVILEGES"

# Setup the LMA user with admin privileges
curl -G "${INFLUXDB_URL}/query" \
    --data-urlencode "q=CREATE USER <%= @influxdb_username %> WITH PASSWORD '<%= @influxdb_userpass %>' WITH ALL PRIVILEGES"

# Create LMA database
curl -G "${INFLUXDB_URL}/query" \
    --data-urlencode "u=<%= @influxdb_username %>" \
    --data-urlencode "p=<%= @influxdb_userpass %>" \
    --data-urlencode "q=CREATE DATABASE <%= @influxdb_dbname %>"
